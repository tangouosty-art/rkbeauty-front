<!doctype html>
<html lang="fr">
<head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Paiement PayPal validé</title></head>
<body>
  <h1>Confirmation PayPal</h1>
  <div id="box">Vérification…</div>

  <script>
    const API_BASE = "https://rkbeauty-api.onrender.com";
    const orderId = new URLSearchParams(location.search).get("token"); // PayPal renvoie token=ORDER_ID

    async function run(){
      if(!orderId){ document.getElementById("box").textContent="OrderId introuvable."; return; }

      const r = await fetch(`${API_BASE}/paypal/capture-order`, {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ orderId })
      });

      const data = await r.json().catch(()=> ({}));
      if(!r.ok){ document.getElementById("box").textContent = data.message || "Erreur capture"; return; }

      const ok = data.status === "COMPLETED";
      document.getElementById("box").innerHTML = ok
        ? `<h2>Paiement validé</h2><p>Statut: <strong>${data.status}</strong></p>`
        : `<h2>Paiement non confirmé</h2><p>Statut: <strong>${data.status}</strong></p>`;
    }
    run();
  </script>

  <p><a href="service.html">Retour</a></p>
</body>
</html>
